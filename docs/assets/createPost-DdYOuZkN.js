import{g as x,s as F,B as N,N as k,e as P,h as B}from"./boot-DLZHiz98.js";import{n as H}from"./auth-B5TyBL4-.js";const I=`${N}/social/posts`,S=document.getElementById("create-form"),s=S instanceof HTMLFormElement?S:null,v=document.getElementById("create-msg"),m=v instanceof HTMLElement?v:null;function l(t,e=!1){if(!m){e||window.alert(t);return}m.style.display="block",m.className=`form-message alert${e?" success":" error"}`,m.textContent=t}function $(t){try{const e=new URL(String(t));return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}}const R=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ™Œ","ðŸ‘","ðŸ‘","ðŸ”¥","ðŸ’¯","âœ¨","âš¡ï¸","ðŸ’¡","ðŸŽ‰","ðŸ«¶","ðŸ™","ðŸ˜…","ðŸ˜‰","ðŸ¤”","ðŸ¤—","ðŸ˜´","ðŸ˜­","ðŸ˜¤","ðŸ™ˆ","ðŸ¤","ðŸ’¬"];let c=null,E=null;function U(){if(c)return c;const t=document.createElement("div");t.className="emoji-palette",t.style.display="none";const e=document.createElement("div");e.className="emoji-grid";const a=R.map(n=>{const o=document.createElement("button");return o.type="button",o.className="emoji-btn",o.textContent=n,o.setAttribute("aria-label",`Insert emoji ${n}`),o.addEventListener("click",()=>{E&&O(E,n),f()}),o});return e.append(...a),t.appendChild(e),document.body.appendChild(t),document.addEventListener("click",n=>{if(!t||t.style.display==="none")return;const o=n.target instanceof Node?n.target:null;(!o||!t.contains(o))&&f()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&f()}),c=t,t}function q(t,e){E=e;const a=U(),n=t.getBoundingClientRect();a.style.left=`${Math.round(n.left)}px`,a.style.top=`${Math.round(n.bottom+6)}px`,a.style.display="block"}function f(){c&&(c.style.display="none")}function O(t,e){try{t.value=`${String(t.value||"")}${String(e||"")}`,t.focus()}catch{}}function w(t){if(!t?.parentElement)return;const e=document.createElement("div");e.className="form-actions",e.style.marginTop="0.5rem";const a=document.createElement("button");a.type="button",a.className="btn btn-outline",a.textContent="ðŸ™‚ Emoji",a.setAttribute("aria-haspopup","true"),a.addEventListener("click",n=>{n.stopPropagation(),q(a,t)}),e.appendChild(a),t.parentElement.appendChild(e)}function A(t,e){t.setAttribute("aria-busy",String(e)),[...t.querySelectorAll("input, textarea, select, button")].forEach(o=>{(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement||o instanceof HTMLButtonElement)&&(o.disabled=e)});const n=t.querySelector('button[type="submit"]');n&&n instanceof HTMLButtonElement&&(e?(n.dataset.prevText=n.textContent||"",n.textContent="Publishingâ€¦"):(n.textContent=n.dataset.prevText||"Publish",delete n.dataset.prevText))}if(s){const t=s.querySelector('[name="title"]'),e=t instanceof HTMLInputElement?t:null,a=s.querySelector('[name="body"]'),n=a instanceof HTMLTextAreaElement?a:null;w(e),w(n),s.addEventListener("keydown",o=>{(o.ctrlKey||o.metaKey)&&o.key==="Enter"&&(o.preventDefault(),s.requestSubmit())}),s.addEventListener("submit",async o=>{if(o.preventDefault(),!(o.currentTarget instanceof HTMLFormElement))return;const p=o.currentTarget,u=new FormData(p),g=String(u.get("title")||"").trim(),b=String(u.get("body")||"").trim(),d=String(u.get("media-url")||"").trim(),h=String(u.get("media-alt")||"").trim();if(!g){l("Title is required.");return}const j=x("accessToken")||"",y=H(j);if(!y){l("You must be logged in to create a post.");return}if(d&&!$(d)){l("Image URL must start with http(s) and be publicly accessible.");return}const C={title:g,...b&&{body:b},...d&&{media:{url:d,...h&&{alt:h}}}},M={"Content-Type":"application/json","X-Noroff-API-Key":k,...y&&{Authorization:`Bearer ${y}`}};A(p,!0),F();try{const r=await fetch(I,{method:"POST",headers:M,body:JSON.stringify(C)});let i=null;try{i=await r.json()}catch{i=null}if(!r.ok)throw new Error(P(i,"Failed to create post"));l("Post created!",!0);const T=i?.data?.id??i?.id,L=T!=null?String(T):"";setTimeout(()=>{L?location.href=`post.html?id=${encodeURIComponent(L)}`:location.href="feed.html"},600)}catch(r){l(r instanceof Error&&r.message?r.message:"Failed to create post.")}finally{B(),f(),A(p,!1)}})}
