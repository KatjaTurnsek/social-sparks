import{g as w,s as A,B as M,N as k,e as $,h as C}from"./boot-DLZHiz98.js";import{n as P}from"./auth-B5TyBL4-.js";const N=document.getElementById("edit-form"),u=N instanceof HTMLFormElement?N:null,F=document.getElementById("edit-msg"),E=F instanceof HTMLElement?F:null;function c(t,e=!1){if(!E){e||window.alert(t);return}E.style.display="block",E.className=`form-message alert${e?" success":" error"}`,E.textContent=t}function B(){try{const e=new URLSearchParams(window.location.search).get("id");return e||""}catch{return""}}const H=["😀","😁","😂","🤣","😊","😍","😎","🤩","🥳","🙌","👍","👏","🔥","💯","✨","⚡️","💡","🎉","🫶","🙏","😅","😉","🤔","🤗","😴","😭","😤","🙈","🤝","💬"];let y=null,v=null;function U(){if(y)return y;const t=document.createElement("div");t.className="emoji-palette",t.style.display="none";const e=document.createElement("div");e.className="emoji-grid";const o=H.map(n=>{const a=document.createElement("button");return a.type="button",a.className="emoji-btn",a.textContent=n,a.setAttribute("aria-label",`Insert emoji ${n}`),a.addEventListener("click",()=>{v&&x(v,n),b()}),a});return e.append(...o),t.appendChild(e),document.body.appendChild(t),document.addEventListener("click",n=>{if(!t||t.style.display==="none")return;const a=n.target instanceof Node?n.target:null;(!a||!t.contains(a))&&b()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&b()}),y=t,t}function R(t,e){v=e;const o=U(),n=t.getBoundingClientRect();o.style.left=`${Math.round(n.left)}px`,o.style.top=`${Math.round(n.bottom+6)}px`,o.style.display="block"}function b(){y&&(y.style.display="none")}function x(t,e){try{t.value=`${String(t.value||"")}${String(e||"")}`,t.focus()}catch{}}function S(t){if(!t||!t.parentElement)return;const e=document.createElement("div");e.className="form-actions",e.style.marginTop="0.5rem";const o=document.createElement("button");o.type="button",o.className="btn btn-outline",o.textContent="🙂 Emoji",o.setAttribute("aria-haspopup","true"),o.addEventListener("click",n=>{n.stopPropagation(),R(o,t)}),e.appendChild(o),t.parentElement.appendChild(e)}async function q(){const t=B();if(!t){c("Missing post id.");return}const e=w("accessToken")||"",o=P(e),n={"X-Noroff-API-Key":k,...o&&{Authorization:`Bearer ${o}`}},a=`${M}/social/posts/${encodeURIComponent(t)}?_author=true`;A();try{const i=await fetch(a,{headers:n});if(i.status===401&&!o){c("You must be logged in to edit this post.");return}let s=null;try{s=await i.json()}catch{s=null}if(!i.ok){c($(s,"Failed to load post"));return}const d=s&&s.data||s||{};if(!u)return;const g=w("profileName")||"",m=typeof d?.author?.name=="string"?d.author.name:"";if(m&&g&&m!==g){c("You can only edit your own post."),window.location.href=`post.html?id=${encodeURIComponent(t)}`;return}const f=u.querySelector('[name="title"]'),p=f instanceof HTMLInputElement||f instanceof HTMLTextAreaElement?f:null;p&&(p.value=d?.title||"");const r=u.querySelector('[name="body"]'),l=r instanceof HTMLTextAreaElement||r instanceof HTMLInputElement?r:null;l&&(l.value=d?.body||"");const T=u.querySelector('[name="media-url"]'),L=u.querySelector('[name="media-alt"]'),j=T instanceof HTMLInputElement?T:null,I=L instanceof HTMLInputElement?L:null,h=d?.media||null;j&&(j.value=typeof h?.url=="string"?h.url:""),I&&(I.value=typeof h?.alt=="string"?h.alt:""),S(p),S(l)}catch(i){const s=i&&typeof i=="object"&&i!==null&&"message"in i?i.message:null;c(typeof s=="string"&&s?s:"Failed to load post.")}finally{C()}}u&&(u.addEventListener("submit",async function(t){t.preventDefault();const e=B();if(!e){c("Missing post id.");return}if(!(t.currentTarget instanceof HTMLFormElement))return;const o=t.currentTarget,n=new FormData(o),a=String(n.get("title")||"").trim(),i=String(n.get("body")||"").trim(),s=String(n.get("media-url")||"").trim(),d=String(n.get("media-alt")||"").trim();if(!a){c("Title is required.");return}const g=w("accessToken")||"",m=P(g);if(!m){c("You must be logged in to save changes.");return}const f={title:a,...i&&{body:i},...s&&{media:{url:s,...d&&{alt:d}}}},p={"Content-Type":"application/json","X-Noroff-API-Key":k,...m&&{Authorization:`Bearer ${m}`}};A();try{const r=await fetch(`${M}/social/posts/${encodeURIComponent(e)}`,{method:"PUT",headers:p,body:JSON.stringify(f)});let l=null;try{l=await r.json()}catch{l=null}if(!r.ok)throw new Error($(l,"Failed to save post"));c("Saved!",!0),window.location.href=`post.html?id=${encodeURIComponent(e)}`}catch(r){const l=r&&typeof r=="object"&&r!==null&&"message"in r?r.message:null;c(typeof l=="string"&&l?l:"Failed to save post.")}finally{C(),b()}}),q());
