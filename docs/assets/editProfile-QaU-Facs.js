import{s as h,h as p,g as u,B as y,N as w,e as A}from"./boot-DLZHiz98.js";import{n as C}from"./auth-B5TyBL4-.js";const E="data:image/gif;base64,R0lGODlhAQABAAAAACw=";function o(t){return document.getElementById(t)}function k(t,e){t&&(t.textContent=e)}function P(){return u("profileName")||""}function L(){const t=u("accessToken"),e=P();return!t||!e?(window.location.href="login.html",!1):!0}async function T(t){const e=u("accessToken")||"",r=C(e),a=`${y}/social/profiles/${encodeURIComponent(t)}`,n={"X-Noroff-API-Key":w,...r&&{Authorization:`Bearer ${r}`}},l=await fetch(a,{headers:n});let i=null;try{i=await l.json()}catch{i=null}if(!l.ok)throw new Error(A(i,"Failed to load profile"));return i?.data||null}async function U(t,e){const r=u("accessToken")||"",a=C(r),n={"Content-Type":"application/json","X-Noroff-API-Key":w,...a&&{Authorization:`Bearer ${a}`}},l=`${y}/social/profiles/${encodeURIComponent(t)}`,i=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify(e)});let s=null;try{s=await i.json()}catch{s=null}if(!i.ok)throw new Error(A(s,"Failed to save profile"));return s?.data||s||null}function f(t,e,r=""){if(!t)return;const a=String(e||"").trim(),n=/^https?:\/\//i.test(a);t.src=n?a:E,t.alt=n?r:"",t.style.display=n?"":"none"}function I(){const t=o("avatar-url"),e=o("avatar-alt"),r=o("banner-url"),a=o("banner-alt"),n=o("avatar-preview"),l=o("banner-preview"),i=()=>f(n,t?.value.trim()||"",e?.value.trim()||""),s=()=>f(l,r?.value.trim()||"",a?.value.trim()||"");t?.addEventListener("input",i),e?.addEventListener("input",i),r?.addEventListener("input",s),a?.addEventListener("input",s)}function N(t){const e=o("bio"),r=o("avatar-url"),a=o("avatar-alt"),n=o("banner-url"),l=o("banner-alt"),i=o("avatar-preview"),s=o("banner-preview");e&&(e.value=t?.bio||""),r&&(r.value=t?.avatar?.url||""),a&&(a.value=t?.avatar?.alt||""),n&&(n.value=t?.banner?.url||""),l&&(l.value=t?.banner?.alt||""),f(i,t?.avatar?.url||"",t?.avatar?.alt||""),f(s,t?.banner?.url||"",t?.banner?.alt||"")}function g(t,e){if(!t)return;[...t.querySelectorAll("input, textarea, button, select")].forEach(n=>{n.disabled=e});const a=o("btn-save");a&&(e?(a.dataset.prevText=a.textContent||"",a.textContent="Savingâ€¦"):(a.textContent=a.dataset.prevText||"Save changes",delete a.dataset.prevText))}function c(t,e){const r=o("edit-profile-msg");r?(r.style.display="block",r.className=`form-message alert${e?" success":" error"}`,r.textContent=t):e||alert(t)}async function x(){if(!L())return;const t=P(),e=o("edit-profile-form"),r=o("heading-name"),a=o("btn-cancel");a&&(a.href=`profile.html?name=${encodeURIComponent(t)}`),h();try{const n=await T(t);k(r,n?.name||t),N(n),I()}catch(n){c(n?.message||"Could not load your profile.",!1)}finally{p()}e&&e.addEventListener("submit",async n=>{n.preventDefault();const l=new FormData(e),i=String(l.get("bio")||"").trim(),s=String(l.get("avatar-url")||"").trim(),d=String(l.get("avatar-alt")||"").trim(),v=String(l.get("banner-url")||"").trim(),m=String(l.get("banner-alt")||"").trim(),b={...i&&{bio:i},...s&&{avatar:{url:s,...d&&{alt:d}}},...v&&{banner:{url:v,...m&&{alt:m}}}};if(Object.keys(b).length===0){c("Please change at least one field before saving.",!1);return}c("",!0),g(e,!0),h();try{await U(t,b),c("Profile updated!",!0),setTimeout(()=>{window.location.href=`profile.html?name=${encodeURIComponent(t)}`},600)}catch(S){c(S?.message||"Failed to save profile.",!1)}finally{p(),g(e,!1)}})}x();
