import{s as M,h as z,g as B,B as D,N as K,e as O}from"./boot-DLZHiz98.js";import{f as Y}from"./dates-4Iv0sr_s.js";import{c as b,a}from"./dom-BvqbnuIy.js";import{n as F}from"./auth-B5TyBL4-.js";const r=document.getElementById("display-container");function q(n){return`profile.html?name=${encodeURIComponent(n)}`}function k(n,e){try{const t=new URLSearchParams(window.location.search),o=parseInt(String(t.get(n)||""),10);return isNaN(o)||o<=0?e:o}catch{return e}}function G(n,e){try{const t=new URLSearchParams(window.location.search);t.set("page",String(n)),t.set("pageSize",String(e));const o=t.toString(),i=window.location.pathname,s=o?`${i}?${o}`:i;window.history.replaceState(null,"",s)}catch{}}function V(){const n=B("accessToken")||"";return!!F(n)}function x(){r&&(r.classList.add("grid"),r.style.display="grid",r.style.gridTemplateColumns="1fr",r.style.gap="1rem")}function X(n,e="You need to be logged in to view the feed."){if(!n)return;b(n),x();const t=document.createElement("article");t.className="card",t.style.gridColumn="1 / -1";const o=document.createElement("h2");o.textContent="Please log in";const i=document.createElement("p");i.className="muted",i.textContent=e;const s=document.createElement("div");s.className="form-actions";const c=document.createElement("a");c.className="btn",c.href="login.html",c.textContent="Log in";const l=document.createElement("a");l.className="btn btn-outline",l.href="register.html",l.textContent="Create account",s.append(c,l),t.append(o,i,s),n.appendChild(t)}async function H(){const n=B("accessToken")||"",e=F(n),t=`${D}/social/posts?_author=true&_comments=false`,o={"X-Noroff-API-Key":K,...e&&{Authorization:`Bearer ${e}`}},i=await fetch(t,{headers:o});let s=null;try{s=await i.json()}catch{s=null}if(!i.ok)throw new Error(O(s,"Failed to load feed"));const c=s?.data??(Array.isArray(s)?s:[]);return Array.isArray(c)?[...c].sort((l,m)=>{const E=l?.created?new Date(l.created).getTime():0;return(m?.created?new Date(m.created).getTime():0)-E}):[]}function R(n){if(!r)return;b(r),x();const e=a("article","card","");e.style.gridColumn="1 / -1";const t=a("p","muted",n||"No posts yet.");e.appendChild(t),r.appendChild(e)}function J(n,e,t){if(!r)return;if(b(r),x(),!n.length){R("No posts yet.");return}const o=n.length,i=Math.max(1,Math.ceil(o/t));e>i&&(e=i);const s=(e-1)*t,c=Math.min(s+t,o),l=[...n].slice(s,c),m=a("div","","");m.style.gridColumn="1 / -1";const E=a("h2","","Feed"),$=`Showing ${s+1}-${c} of ${o}`,_=a("p","muted",$);m.append(E,_),r.appendChild(m);for(const p of l){const S=a("article","card",""),P=a("h3","","");P.textContent=p?.title||"Untitled";const u=a("p","muted",""),C=p?.author?.name??"Unknown",A=p?.created?Y(p.created):"";if(u.textContent="by ",C!=="Unknown"){const d=document.createElement("a");d.href=q(C),d.textContent=C,u.appendChild(d)}else u.append(C);A&&u.append(` · ${A}`);const h=p?.media||null;if(typeof h?.url=="string"&&h.url){const d=document.createElement("img");d.src=h.url,d.alt=typeof h?.alt=="string"?h.alt:"",d.loading="lazy",d.className="post-media",S.appendChild(d)}const w=a("p","",p?.body||"");(w.textContent||"").length>260&&(w.textContent=`${(w.textContent||"").slice(0,257)}...`);const I=a("div","form-actions",""),U=a("a","btn btn-outline","View"),j=p?.id!=null?String(p.id):"";U.href=`post.html?id=${encodeURIComponent(j)}`,I.appendChild(U),S.append(P,u,w,I),r.appendChild(S)}const f=a("div","form-actions","");f.style.gridColumn="1 / -1",f.style.justifyContent="space-between";const v=a("div","",""),N=a("div","",""),g=a("a","btn btn-outline","← Previous"),y=a("a","btn btn-outline","Next →"),L=a("span","muted","");L.textContent=`Page ${e} of ${i}`,e<=1?(g.style.pointerEvents="none",g.style.opacity="0.6"):g.href=T(e-1,t),e>=i?(y.style.pointerEvents="none",y.style.opacity="0.6"):y.href=T(e+1,t),v.appendChild(g),N.append(L,y),f.append(v,N),r.appendChild(f)}function T(n,e){try{const t=new URLSearchParams(window.location.search);return t.set("page",String(n)),t.set("pageSize",String(e)),`${window.location.pathname}?${t.toString()}`}catch{return`feed.html?page=${String(n)}&pageSize=${String(e)}`}}async function Q(){if(!V()){X(r);return}const n=k("page",1),e=k("pageSize",10);if(r){b(r),x();const t=a("div","","");t.style.gridColumn="1 / -1",t.append(a("h2","","Feed")),t.append(a("p","muted","Loading…")),r.appendChild(t),[...Array(Math.min(e,5))].forEach(()=>{const o=a("div","card skeleton","");o.style.height="140px",r.appendChild(o)})}M();try{const t=await H();G(n,e),J(t,n,e)}catch(t){const o=t&&typeof t=="object"&&t!==null&&"message"in t?t.message:null;R(typeof o=="string"&&o?o:"Could not load feed.")}finally{z()}}Q();
