import{s as f,B as d,e as u,a as i,h as m}from"./boot-DLZHiz98.js";const g=`${d}/auth/login`,c=document.getElementById("login-form");function a(o,n="error"){const e=document.getElementById("login-msg");if(e){e.style.display="block",e.className=`form-message alert ${n==="success"?"success":"error"}`,e.textContent=o;return}n==="error"&&alert(o)}function l(o,n){o.setAttribute("aria-busy",String(n)),[...o.querySelectorAll("input, select, textarea, button")].forEach(r=>{(r instanceof HTMLInputElement||r instanceof HTMLButtonElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement)&&(r.disabled=n)});const t=o.querySelector('button[type="submit"]');if(t&&t instanceof HTMLButtonElement)if(n)t.setAttribute("data-prev-text",t.textContent||""),t.textContent="Signing inâ€¦";else{const r=t.getAttribute("data-prev-text")||"Sign in";t.textContent=r,t.removeAttribute("data-prev-text")}}async function p(o){f();try{const n=await fetch(g,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}});let e=null;try{e=await n.json()}catch{e=null}if(!n.ok)throw new Error(u(e,"Login failed"));const t={...e||{},...e&&typeof e.data=="object"?e.data:{}},r=typeof t.accessToken=="string"?t.accessToken:"";if(!r)throw new Error("No access token returned.");i("accessToken",r);const s=typeof t.name=="string"?t.name:"";return s&&i("profileName",s),e}finally{m()}}function h(o){o.preventDefault();const n=o.target,e=new FormData(n),t=String(e.get("email")||""),r=String(e.get("password")||"");if(!t||!t.includes("@")){a("Please enter a valid email address.","error");return}if(!r){a("Please enter your password.","error");return}l(n,!0),p({email:t,password:r}).then(()=>{window.location.href="feed.html"}).catch(s=>{a(s&&s.message||"Login failed","error")}).finally(()=>{l(n,!1)})}(function(){(localStorage.getItem("accessToken")||"")&&window.location.replace("feed.html")})();(function(){const e=new URLSearchParams(location.search).get("notice");e&&a(e,"success")})();c&&c.addEventListener("submit",h);
