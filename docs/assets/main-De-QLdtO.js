import{s as x,h as b,g as P,B as k,e as L,N as T}from"./boot-DLZHiz98.js";import{n as A}from"./auth-B5TyBL4-.js";import{f as $}from"./dates-4Iv0sr_s.js";import{c as f}from"./dom-BvqbnuIy.js";const c=document.getElementById("display-container"),i=document.getElementById("profiles-container"),g=document.getElementById("profiles-pager"),N=document.getElementById("profile-search-form"),v=document.getElementById("profile-q"),U=`${k}/social/posts?_author=true&_comments=false&sort=created&sortOrder=desc`;function I(e){return`profile.html?name=${encodeURIComponent(e)}`}function j(){const e=P("accessToken")||"";return!!A(e)}function F(e,t="You need to be logged in to view posts and profiles."){if(!e)return;f(e),e.parentElement&&(e.parentElement.style.gridColumn="1 / -1"),e.classList.remove("grid"),e.style.display="block",e.style.gridTemplateColumns="",e.style.gap="",e.style.gridColumn="1 / -1",e.style.width="100%",e.style.maxWidth="none";const n=document.createElement("article");n.className="card",n.style.width="100%",n.style.margin="0";const s=document.createElement("h2");s.textContent="Please log in";const a=document.createElement("p");a.className="muted",a.textContent=t;const o=document.createElement("div");o.className="form-actions";const l=document.createElement("a");l.className="btn",l.href="login.html",l.textContent="Log in";const r=document.createElement("a");r.className="btn btn-outline",r.href="register.html",r.textContent="Create account",o.append(l,r),n.append(s,a,o),e.appendChild(n)}function S(){const e=P("accessToken")||"",t=A(e);return{"X-Noroff-API-Key":T,...t&&{Authorization:`Bearer ${t}`}}}async function q(){const e=await fetch(U,{headers:S()});let t=null;try{t=await e.json()}catch{t=null}if(!e.ok)throw new Error(L(t,e.statusText||"Failed to load posts"));let n=[];return Array.isArray(t?.data)?n=t.data:Array.isArray(t)&&(n=t),[...n].sort((s,a)=>{const o=s?.created?new Date(s.created).getTime():0;return(a?.created?new Date(a.created).getTime():0)-o})}function O(e){if(!c)return;f(c);const t=document.createElement("article");t.className="card";const n=document.createElement("p");n.className="alert error",n.textContent=e||"Something went wrong.",t.appendChild(n),c.appendChild(t);const s=document.createElement("div");s.className="form-actions",s.style.justifyContent="center";const a=document.createElement("a");a.className="btn btn-outline",a.href="feed.html",a.textContent="View more posts",s.appendChild(a),c.appendChild(s)}function R(e){const t=String(e||"").trim();if(!t)return"";for(let n=0;n<t.length;n+=1){const s=t[n];if(s==="."||s==="!"||s==="?")return t.slice(0,n+1).trim();if(s===`
`)return t.slice(0,n).trim()}return t.length>140?`${t.slice(0,140).trim()}…`:t}function _(e){if(!c)return;f(c),c.classList.add("grid"),c.style.display="grid",c.style.gridTemplateColumns="repeat(4, minmax(0, 1fr))",c.style.gap="1rem";const t=Array.isArray(e)?[...e].slice(0,4):[];if(!t.length){const a=document.createElement("p");a.className="muted",a.textContent="No posts yet.",c.appendChild(a);return}for(const a of t){const o=document.createElement("article");o.className="card";const l=document.createElement("h2");l.textContent=a?.title||"Untitled";const r=document.createElement("p");r.className="muted",r.style.wordBreak="break-word";const p=a?.author?.name?String(a.author.name):"Unknown",m=a?.created?$(a.created):"";if(r.textContent="by ",p!=="Unknown"){const u=document.createElement("a");u.href=I(p),u.textContent=p,r.appendChild(u)}else r.append(p);m&&r.append(` · ${m}`);const d=a?.media||null;if(typeof d?.url=="string"&&d.url){const u=document.createElement("img");u.src=d.url,u.alt=typeof d?.alt=="string"?d.alt:"",u.loading="lazy",u.className="post-media index-post-image",o.appendChild(u)}const E=document.createElement("p");E.textContent=R(a?.body||"");const h=document.createElement("div");h.className="form-actions";const C=document.createElement("a");C.className="btn btn-outline";const B=a?.id!=null?a.id:"";C.href=`post.html?id=${encodeURIComponent(String(B))}`,C.textContent="View",h.appendChild(C),o.append(l,r,E,h),c.appendChild(o)}const n=document.createElement("div");n.className="form-actions",n.style.gridColumn="1/-1",n.style.justifyContent="center";const s=document.createElement("a");s.className="btn btn-outline",s.href="feed.html",s.textContent="View more posts",n.appendChild(s),c.appendChild(n)}async function W(e={}){const t=e.q||"",n=Math.max(1,e.page||1),s=Math.max(1,Math.min(100,e.limit||12)),a=e.sort||"created",o=e.sortOrder||"desc",l=t?"/social/profiles/search":"/social/profiles",r=new URLSearchParams;r.set("limit",String(s)),r.set("page",String(n)),r.set("sort",a),r.set("sortOrder",o),t&&r.set("q",t);const p=`${k}${l}?${r.toString()}`,m=await fetch(p,{headers:S()});let d=null;try{d=await m.json()}catch{d=null}if(!m.ok)throw new Error(L(d,"Failed to load profiles"));const E=(Array.isArray(d?.data)?d.data:[])||[],h=d?.meta||{};return{list:[...E],meta:{...h}}}function D(e){if(!i)return;f(i);const t=document.createElement("article");t.className="card";const n=document.createElement("p");n.className="alert error",n.textContent=e||"Could not load profiles.",t.appendChild(n),i.appendChild(t),g&&f(g)}function V(e){if(!i)return;if(f(i),i.classList.add("grid"),i.style.display="grid",i.style.gridTemplateColumns="repeat(auto-fit, minmax(220px, 1fr))",i.style.gap="1rem",!e.length){const n=document.createElement("p");n.className="muted",n.textContent="No profiles found.",i.appendChild(n);return}const t=[...e];for(const n of t){const s=document.createElement("article");s.className="card";const a=document.createElement("div");a.style.display="flex",a.style.gap="0.75rem",a.style.alignItems="center";const o=document.createElement("img");o.style.width="48px",o.style.height="48px",o.style.borderRadius="999px",o.style.objectFit="cover",n?.avatar?.url?(o.src=n.avatar.url,o.alt=n.avatar.alt||""):o.style.display="none";const l=document.createElement("div"),r=document.createElement("p");r.style.margin="0",r.style.fontWeight="600",r.style.wordBreak="break-word",r.textContent=n?.name||"Unknown";const p=document.createElement("div");p.className="form-actions";const m=document.createElement("a");m.className="btn btn-outline",m.href=I(n?.name||""),m.textContent="View",p.appendChild(m),l.appendChild(r),a.append(o,l),s.append(a,p),i.appendChild(s)}}function z(e,t){if(!g)return;f(g);const n=document.createElement("div"),s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="0.5rem";const a=document.createElement("button");a.type="button",a.className="btn btn-outline",a.textContent="← Previous";const o=document.createElement("button");o.type="button",o.className="btn btn-outline",o.textContent="Next →";const l=document.createElement("span");l.className="muted";const r=e.currentPage||1,p=e.pageCount||1;l.textContent=`Page ${r} of ${p}`;const m=e.previousPage||(e.isFirstPage,null),d=e.nextPage||(e.isLastPage,null);m?a.addEventListener("click",()=>t(m)):(a.disabled=!0,a.style.opacity="0.6"),d?o.addEventListener("click",()=>t(d)):(o.disabled=!0,o.style.opacity="0.6"),n.appendChild(a),s.append(l,o),g.append(n,s)}let y={q:"",page:1,limit:12};async function w(){try{const{list:e,meta:t}=await W({q:y.q,page:y.page,limit:y.limit,sort:"created",sortOrder:"desc"});V(e),z(t,n=>{y={...y,page:n},x(),w().finally(b)})}catch(e){const t=e&&typeof e=="object"&&e!==null&&"message"in e?e.message:null;D(typeof t=="string"&&t?t:"Could not load profiles.")}}async function M(){if(!j()){i&&(i.style.display="none"),g&&(g.style.display="none"),F(c);return}if(c){f(c);const e=document.createElement("div");e.style.display="grid",e.style.gridTemplateColumns="repeat(4, minmax(0, 1fr))",e.style.gap="1rem";const t=[...Array(4)].map(()=>{const n=document.createElement("div");return n.className="card skeleton",n.style.height="160px",n});e.append(...t),c.appendChild(e)}if(i){f(i);const e=document.createElement("div");e.className="card skeleton",e.style.height="120px",i.appendChild(e)}x();try{const e=await q();_(e),await w()}catch(e){const t=e&&typeof e=="object"&&e!==null&&"message"in e?e.message:null;O(typeof t=="string"&&t?t:"Could not load posts.")}finally{b()}N&&v&&N.addEventListener("submit",e=>{e.preventDefault(),y={...y,q:v.value.trim(),page:1},x(),w().finally(b)})}M();
