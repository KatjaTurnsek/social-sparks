import{s as j,h as A,g as b,B as T,N as v,e as $,b as X}from"./boot-DLZHiz98.js";import{f as K}from"./dates-4Iv0sr_s.js";import{n as N}from"./auth-B5TyBL4-.js";const C=document.getElementById("display-container"),q=["👍","❤️","😂","🎉","😮","😢"],H=["😀","😁","😂","🤣","😊","😍","😎","🤩","🥳","🙌","👍","👏","🔥","💯","✨","⚡️","💡","🎉","🫶","🙏","😅","😉","🤔","🤗","😴","😭","😤","🙈","🤝","💬"];let g=null,S=null;function W(){if(g)return g;const e=document.createElement("div");e.className="emoji-palette",e.style.display="none";const n=document.createElement("div");n.className="emoji-grid";const o=H.map(a=>{const c=document.createElement("button");return c.type="button",c.className="emoji-btn",c.textContent=a,c.setAttribute("aria-label",`Insert emoji ${a}`),c.addEventListener("click",()=>{S&&G(S,a),R()}),c});return n.append(...o),e.appendChild(n),document.body.appendChild(e),document.addEventListener("click",a=>{if(!e||e.style.display==="none")return;const c=a.target instanceof Node?a.target:null;(!c||!e.contains(c))&&R()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&R()}),g=e,e}function J(e,n){S=n;const o=W(),a=e.getBoundingClientRect();o.style.left=`${Math.round(a.left)}px`,o.style.top=`${Math.round(a.bottom+6)}px`,o.style.display="block"}function R(){g&&(g.style.display="none")}function G(e,n){try{e.value=String(e.value||"")+String(n||""),e.focus()}catch{}}function Q(e){if(!e?.parentElement)return;const n=document.createElement("div");n.className="form-actions",n.style.marginTop="0.5rem";const o=document.createElement("button");o.type="button",o.className="btn btn-outline",o.textContent="🙂 Emoji",o.setAttribute("aria-haspopup","true"),o.addEventListener("click",a=>{a.stopPropagation(),J(o,e)}),n.appendChild(o),e.parentElement.appendChild(n)}function z(e){return`profile.html?name=${encodeURIComponent(e)}`}function V(){try{const n=new URLSearchParams(window.location.search).get("id");return n||""}catch{return""}}async function B(e){const n=b("accessToken")||"",o=N(n),a=`${T}/social/posts/${encodeURIComponent(e)}?_author=true&_comments=true&_reactions=true`,c={"X-Noroff-API-Key":v,...o&&{Authorization:"Bearer "+o}},d=await fetch(a,{headers:c});let l=null;try{l=await d.json()}catch{l=null}if(!d.ok)throw new Error($(l,d.statusText||"Failed to load post"));return l?.data||null}async function Z(e,n,o){const a=b("accessToken")||"",c=N(a);if(!c)throw new Error("You must be logged in to comment.");const d=`${T}/social/posts/${encodeURIComponent(String(e))}/comment`,l={"X-Noroff-API-Key":v,"Content-Type":"application/json",Authorization:`Bearer ${c}`},u=await fetch(d,{method:"POST",headers:l,body:JSON.stringify({body:n})});let f=null;try{f=await u.json()}catch{f=null}if(!u.ok)throw new Error($(f,"Failed to post comment"));return f?.data||f||null}async function ee(e,n,o){const a=b("accessToken")||"",c=N(a);if(!c)throw new Error("You must be logged in to react.");const d=`${T}/social/posts/${encodeURIComponent(String(e))}/react/${encodeURIComponent(n)}`,l={method:o?"PUT":"DELETE",headers:{"X-Noroff-API-Key":v,...c&&{Authorization:`Bearer ${c}`}}},y=await fetch(d,l);let u=null;try{u=await y.json()}catch{u=null}if(!y.ok)throw new Error($(u,"Failed to update reaction"))}function te(e){return(Array.isArray(e?.reactions)?e.reactions:[]).reduce((o,a)=>{const c=typeof a?.symbol=="string"?a.symbol:"";return c?{...o,[c]:{count:typeof a?.count=="number"?a.count:0,reacted:!!a?.reacted}}:o},{})}function F(e){if(!C)return;C.innerHTML="";const n=document.createElement("article");n.className="card";const o=document.createElement("h2");o.textContent=e?.title||"Untitled";const a=document.createElement("p");a.className="muted";const c=e?.author?.name||"Unknown",d=e?.created?K(e.created):"";if(a.textContent="by ",c!=="Unknown"){const t=document.createElement("a");t.href=z(c),t.textContent=c,a.appendChild(t)}else a.append(c);d&&a.append(` · ${d}`);const l=e?.media||null;if(typeof l?.url=="string"&&l.url){const t=document.createElement("img");t.src=l.url,t.alt=typeof l?.alt=="string"?l.alt:"",t.loading="lazy",t.className="post-media",t.style.maxHeight="none",t.style.height="auto",t.style.width="100%",t.style.objectFit="contain",t.style.display="block",n.appendChild(t)}const y=document.createElement("p");y.textContent=e?.body||"";const u=document.createElement("div");u.className="reactions";const f=te(e),I=!!N(b("accessToken")||""),P=e?.id!=null?String(e.id):"";for(const t of q){const i=f[t]?.count||0,s=!!f[t]?.reacted,r=document.createElement("button");r.type="button",r.className="reaction-btn",r.setAttribute("aria-pressed",s?"true":"false"),r.title=s?`Remove ${t}`:`React with ${t}`,r.textContent=`${t} ${i>0?i:""}`.trim(),r.addEventListener("click",async()=>{if(!I||!P){I||window.alert("Please log in to react.");return}r.disabled=!0,j();try{await ee(P,t,!s);const m=await B(P);F(m)}catch(m){const p=m&&typeof m=="object"&&m!==null&&"message"in m?m.message:null;window.alert(typeof p=="string"&&p?p:"Could not update reaction.")}finally{A(),r.disabled=!1}}),u.appendChild(r)}const O=b("profileName")||"",Y=!!O&&c!=="Unknown"&&O===c;let w=null;if(Y){w=document.createElement("div"),w.className="form-actions";const t=e?.id!==void 0&&e?.id!==null?String(e.id):"",i=document.createElement("a");i.className="btn btn-outline",i.href=`edit-post.html?id=${encodeURIComponent(t)}`,i.textContent="Edit";const s=document.createElement("button");s.className="btn btn-outline",s.type="button",s.textContent="Delete",s.addEventListener("click",function(){ne(t,c)}),w.appendChild(i),w.appendChild(s)}const k=document.createElement("section"),M=document.createElement("h3");M.textContent="Comments",k.appendChild(M);const D=Array.isArray(e?.comments)?[...e.comments]:[];if(D.length>0)for(const t of D){const i=document.createElement("article");i.className="card",i.style.padding="1rem";const s=document.createElement("p");s.className="muted";let r=null;t?.author?.name?r=t.author.name:typeof t?.owner=="string"&&t.owner&&(r=t.owner);const m=t?.created?K(t.created):"";if(r){s.append("by ");const h=document.createElement("a");h.href=z(r),h.textContent=r,s.appendChild(h)}else s.textContent="Anonymous";m&&s.append(` · ${m}`);const p=document.createElement("p");p.textContent=t?.body||"",i.appendChild(s),i.appendChild(p),k.appendChild(i)}else{const t=document.createElement("p");t.className="muted",t.textContent="No comments yet.",k.appendChild(t)}const x=document.createElement("section");x.style.marginTop="1rem";const L=e?.id!==void 0&&e?.id!==null?String(e.id):"";if(I&&L){const t=document.createElement("form");t.className="form";const i=document.createElement("div");i.className="form-group";const s=document.createElement("label");s.setAttribute("for","comment-body"),s.textContent="Add a comment";const r=document.createElement("textarea");r.id="comment-body",r.name="comment",r.placeholder="Write your comment…",r.required=!0,r.rows=3;const m=document.createElement("div");m.className="form-actions";const p=document.createElement("button");p.type="submit",p.className="btn",p.textContent="Post comment",m.appendChild(p),i.appendChild(s),i.appendChild(r),t.appendChild(i),t.appendChild(m),Q(r),t.addEventListener("submit",async h=>{h.preventDefault();const _=r.value.trim();if(!_){window.alert("Please write a comment first."),r.focus();return}p.disabled=!0,j();try{await Z(L,_),r.value="";const E=await B(L);F(E)}catch(E){const U=E&&typeof E=="object"&&E!==null&&"message"in E?E.message:null;window.alert(typeof U=="string"&&U?U:"Could not post comment.")}finally{A(),p.disabled=!1}}),t.addEventListener("keydown",h=>{(h.ctrlKey||h.metaKey)&&h.key==="Enter"&&(h.preventDefault(),t.requestSubmit())}),x.appendChild(t)}else{const t=document.createElement("p");t.className="muted",t.innerHTML='You need to <a href="login.html">log in</a> to comment.',x.appendChild(t)}n.appendChild(o),n.appendChild(a),n.appendChild(y),n.appendChild(u),w&&n.appendChild(w),n.appendChild(k),n.appendChild(x),C.appendChild(n)}async function ne(e,n){if(!e)return;const o=b("profileName")||"";if(!o||o!==n){window.alert("You can only delete your own posts.");return}if(!window.confirm("Delete this post?"))return;const c=b("accessToken")||"",d=N(c),l=`${T}/social/posts/${encodeURIComponent(e)}`,y={"X-Noroff-API-Key":v,...d&&{Authorization:`Bearer ${d}`}};j();try{const u=await fetch(l,{method:"DELETE",headers:y});let f=null;try{f=await u.json()}catch{f=null}if(u.status===204){X("Post deleted.","success",2500),window.location.href="feed.html";return}window.alert($(f,"Failed to delete"))}finally{A()}}async function oe(){const e=V();if(!e){C&&(C.textContent="Missing post id.");return}j();try{const n=await B(e);F(n)}catch(n){const o=n&&typeof n=="object"&&n!==null&&"message"in n?n.message:null;C&&(C.textContent=typeof o=="string"&&o?o:"Could not load post.")}finally{A()}}oe();
