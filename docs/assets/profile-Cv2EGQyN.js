import{s as I,g,h as S,B as R,N as M,e as j}from"./boot-DLZHiz98.js";import{n as L}from"./auth-B5TyBL4-.js";import{f as O}from"./dates-4Iv0sr_s.js";function r(e){return document.getElementById(e)}function h(e,a){e&&(e.textContent=a)}function T(e,a,m){if(!e)return;const t=e.dataset.placeholder||e.getAttribute("src")||"";!e.dataset.placeholder&&t&&(e.dataset.placeholder=t),a?(e.src=a,e.alt=m||"",e.style.display=""):(e.dataset.placeholder&&(e.src=e.dataset.placeholder),e.alt="",e.style.display="none")}function V(){try{return new URLSearchParams(window.location.search||"").get("name")||""||g("profileName")||""}catch{return g("profileName")||""}}function _(e,a){return e?.trim().toLowerCase()===a?.trim().toLowerCase()}async function X(e){const a=g("accessToken")||"",m=L(a),t=`${R}/social/profiles/${encodeURIComponent(e)}?_posts=true&_followers=true&_following=true`,d={"X-Noroff-API-Key":M,...m&&{Authorization:`Bearer ${m}`}},i=await fetch(t,{headers:d});let n=null;try{n=await i.json()}catch{n=null}if(!i.ok)throw new Error(j(n,"Failed to load profile"));return n?.data||null}async function D(e,a){const m=g("accessToken")||"",t=L(m),d={"X-Noroff-API-Key":M,...t&&{Authorization:`Bearer ${t}`}},i=`${R}/social/profiles/${encodeURIComponent(e)}/${a}`,n=await fetch(i,{method:"PUT",headers:d});let s=null;try{s=await n.json()}catch{s=null}if(!n.ok){const f=new Error(j(s,"Failed"));throw f.status=n.status,f}return s?.data||s||null}function W(e,a){if(!e)return;if(e.innerHTML="",e.classList.add("grid"),!Array.isArray(a)||a.length===0){const t=document.createElement("p");t.className="muted",t.textContent="No posts yet.",e.appendChild(t);return}[...a].forEach(t=>{const d=document.createElement("article");d.className="card post-card";const i=document.createElement("h4");i.textContent=t?.title||"Untitled";const n=document.createElement("p");if(n.className="muted",n.textContent=t?.created?String(O(t.created)):"",t?.media?.url){const u=document.createElement("img");u.loading="lazy",u.src=t.media.url,u.alt=t.media?.alt||"",d.appendChild(u)}const s=document.createElement("p");s.textContent=t?.body||"",s.className="clamp-2";const f=document.createElement("div");f.className="form-actions";const l=document.createElement("a");l.className="btn btn-outline";const c=t?.id!=null?String(t.id):"";l.href=`post.html?id=${encodeURIComponent(c)}`,l.textContent="View",f.appendChild(l),d.append(i,n,s,f),e.appendChild(d)})}function $(e,a){if(!e)return;e.innerHTML="",e.classList.remove("grid");const m=Array.isArray(a)?[...a]:[];if(m.length===0){const t=document.createElement("p");t.className="muted",t.textContent="Nothing to show.",e.appendChild(t);return}m.forEach(t=>{const d=document.createElement("article");d.className="card";const i=document.createElement("div");i.style.display="flex",i.style.gap="0.75rem",i.style.alignItems="center";const n=document.createElement("img");n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",t?.avatar?.url?(n.src=t.avatar.url,n.alt=t.avatar?.alt||""):n.style.display="none";const s=document.createElement("div"),f=document.createElement("p");f.style.margin="0",f.style.fontWeight="600",f.textContent=t?.name||"Unknown";const l=document.createElement("p");l.className="muted",l.style.margin="0",l.textContent=t?.bio||"",s.append(f,l);const c=document.createElement("a");c.className="btn btn-outline",c.textContent="View",c.href=`profile.html?name=${encodeURIComponent(t?.name||"")}`,i.append(n,s,c),d.appendChild(i),e.appendChild(d)})}async function Y(){const e=V(),a=r("profile-banner"),m=r("profile-avatar"),t=r("profile-name"),d=r("profile-email"),i=r("profile-bio"),n=r("count-posts"),s=r("count-followers"),f=r("count-following"),l=r("btn-follow"),c=r("btn-unfollow"),u=r("btn-edit"),z=r("panel-posts"),B=r("panel-followers"),K=r("panel-following");if(!e){h(r("page-msg"),"No profile name provided.");return}I();try{let E=function(){if(!(!l||!c)){if(!C||k){l.style.display="none",c.style.display="none";return}l.style.display=y?"none":"",c.style.display=y?"":"none",s&&h(s,String(Math.max(0,N)))}};const o=await X(e);h(t,o?.name||"Profile"),h(d,o?.email||""),h(i,o?.bio||""),T(m,o?.avatar?.url?o.avatar.url:"",o?.avatar?.alt||""),T(a,o?.banner?.url?o.banner.url:"",o?.banner?.alt||"");const w={posts:0,followers:0,following:0,...o?._count||{}};h(n,String(w.posts||0)),h(s,String(w.followers||0)),h(f,String(w.following||0));const q=g("accessToken")||"",C=L(q),A=g("profileName")||"",k=C&&A&&o?.name?_(A,o.name):!1;u&&(k?(u.hidden=!1,u.href="edit-profile.html",u.onclick=null):u.remove());const F=Array.isArray(o?.followers)?[...o.followers]:[];let N=(typeof o?._count?.followers=="number"?o._count.followers:F.length)||0,y=!!C&&!k&&!!A&&F.some(p=>p?.name&&_(String(p.name),A));async function P(p){if(o?.name){if(!C){window.location.href="login.html";return}l&&(l.disabled=!0),c&&(c.disabled=!0),I();try{await D(o.name,p),p==="follow"&&!y?(y=!0,N+=1):p==="unfollow"&&y&&(y=!1,N=Math.max(0,N-1)),E()}catch(v){const b=v?.status;if(b===401||b===403){window.location.href="login.html";return}window.alert(v?.message||"Failed to update follow state")}finally{S(),l&&(l.disabled=!1),c&&(c.disabled=!1)}}}l&&(l.onclick=()=>P("follow")),c&&(c.onclick=()=>P("unfollow")),E(),W(z,Array.isArray(o?.posts)?[...o.posts]:[]),$(B,Array.isArray(o?.followers)?[...o.followers]:[]),$(K,Array.isArray(o?.following)?[...o.following]:[]);const U=[...document.querySelectorAll(".tabs .tab")],H=[...document.querySelectorAll(".tabpanel")];U.forEach(p=>{p.addEventListener("click",()=>{U.forEach(x=>x.classList.remove("is-active")),p.classList.add("is-active");const v=p.getAttribute("data-tab");H.forEach(x=>x.classList.add("is-hidden"));const b=r(`panel-${v||""}`);b&&b.classList.remove("is-hidden")})})}catch(o){const w=r("page-msg");w?(w.style.display="block",w.className="form-message alert error",w.textContent=o&&o.message||"Could not load profile."):window.alert(o&&o.message||"Could not load profile.")}finally{S()}}Y();
