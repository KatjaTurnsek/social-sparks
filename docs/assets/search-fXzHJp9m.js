import{s as S,h as A,g as k,B as L,N,e as v}from"./boot-DLZHiz98.js";import{f as I}from"./dates-4Iv0sr_s.js";import{c as u,a as n}from"./dom-BvqbnuIy.js";import{n as R}from"./auth-B5TyBL4-.js";const e=document.getElementById("display-container");function U(){try{const t=new URLSearchParams(window.location.search).get("q");return t?String(t):""}catch{return""}}async function B(r){const t=k("accessToken")||"",o=R(t),m=`${L}/social/posts/search?q=${encodeURIComponent(r)}`,h={"X-Noroff-API-Key":N,...o&&{Authorization:`Bearer ${o}`}},d=await fetch(m,{headers:h});let s=null;try{s=await d.json()}catch{s=null}if(!d.ok)throw new Error(v(s,"Failed to search posts"));const a=s?.data??s;return[...Array.isArray(a)?a:[]]}function f(){e&&(e.classList.add("grid"),e.style.display="grid",e.style.gridTemplateColumns="repeat(auto-fit, minmax(260px, 1fr))",e.style.gap="1rem")}function x(r){if(!e)return;u(e),f();const t=n("article","card","");t.style.gridColumn="1 / -1";const o=n("p","muted",r||"No results.");t.appendChild(o),e.appendChild(t)}function F(r,t){if(!e)return;u(e),f();const o=n("div","","");o.style.gridColumn="1 / -1";const m=n("h2","","Search"),h=t.length===1?"result":"results",d=`Query: "${r}" · ${t.length} ${h}`,s=n("p","muted",d);if(o.append(m,s),e.appendChild(o),!t.length){const a=n("p","muted","No posts matched your search.");a.style.gridColumn="1 / -1",e.appendChild(a);return}for(const a of t){const l=n("article","card",""),y=n("h3","","");y.textContent=a?.title||"Untitled";const g=n("p","muted",""),C=a?.author?.name??"Unknown",w=a?.created?I(a.created):"";g.textContent=w?`by ${C} · ${w}`:`by ${C}`;const c=a?.media||null;if(typeof c?.url=="string"&&c.url){const i=document.createElement("img");i.src=c.url,i.alt=typeof c?.alt=="string"?c.alt:"",i.loading="lazy",i.className="post-thumb",l.appendChild(i)}const p=n("p","",a?.body||"");(p.textContent||"").length>240&&(p.textContent=`${(p.textContent||"").slice(0,237)}...`);const $=n("div","form-actions",""),b=n("a","btn btn-outline","View"),E=a?.id!=null?String(a.id):"";b.href=`post.html?id=${encodeURIComponent(E)}`,$.appendChild(b),l.append(y,g,p,$),e.appendChild(l)}}async function P(){const r=U();if(!r){x("Enter a search term, e.g. search.html?q=dogs");return}if(e){u(e),f();const t=n("div","","");t.style.gridColumn="1 / -1",t.append(n("h2","","Search")),t.append(n("p","muted",`Searching for "${r}"…`)),e.appendChild(t),[...Array(3)].forEach(()=>{const o=n("div","card skeleton","");o.style.height="140px",e.appendChild(o)})}S();try{const t=await B(r);F(r,t)}catch(t){const o=t&&typeof t=="object"&&t!==null&&"message"in t?t.message:null;x(typeof o=="string"&&o?o:"Search failed.")}finally{A()}}P();
